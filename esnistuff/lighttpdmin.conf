
# Be nice to not have to use an absolute path here.
var.rootroot="/home/stephen/code/openssl/esnistuff"

# standard stuff - testlighttpd.sh makes these dirs if needed
server.document-root = rootroot + "/lighttpd/www"
var.log_root    = rootroot + "/lighttpd/log"
server.errorlog = log_root + "/error.log"

# Looks like we need to listen on some port for cleartext and
# can't turn that off. Or, at least, I've not yet found out
# how.
server.port = 3000

server.modules += ( "mod_accesslog" )
accesslog.filename          = log_root + "/access.log"

mimetype.assign = (
  ".html" => "text/html", 
  ".txt" => "text/plain",
  ".jpg" => "image/jpeg",
  ".png" => "image/png" 
)

server.modules += ( "mod_openssl" )
var.cadir= rootroot + "/cadir"


$SERVER["socket"] == "127.0.0.1:3443" {
    ssl.engine                  = "enable"
    ssl.cipher-list             = "HIGH"   # default
    ssl.ca-file                 = cadir + "/oe.csr"
    ssl.openssl.ssl-conf-cmd    = ("Protocol" => "-ALL, TLSv1.2, TLSv1.3")
    ssl.pemfile                 = cadir + "/example.com.pem"
    server.name                 = "example.com"
    $HTTP["host"] == "foo.example.com" {
        ssl.pemfile                 = cadir + "/foo.example.com.pem"
        server.name                 = "foo.example.com"
    }
    # same as before, probaby better if not:-)
    server.document-root        = rootroot + "/lighttpd/www"
}


